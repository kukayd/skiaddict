‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á Chat ‡πÅ‡∏•‡πâ‡∏ß Copy ‡πÑ‡∏õ‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ

‡∏ú‡∏°‡∏Ç‡∏≠‡∏™‡πà‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ö‡∏ö **Clean Version** (‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á CSS ‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏±‡∏¢‡∏¢‡∏∏‡∏ó‡∏ò Copy ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô Notepad ‡πÅ‡∏•‡πâ‡∏ß Save ‡πÄ‡∏õ‡πá‡∏ô `.html` ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**

1. ‡πÄ‡∏õ‡∏¥‡∏î Notepad (‡∏´‡∏£‡∏∑‡∏≠ Text Editor)
2. Copy ‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏õ‡∏ß‡∏≤‡∏á
3. Save As ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå `skiaddict_announce.html`
4. **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå `SkiAddict Logo (4).png` ‡πÅ‡∏•‡∏∞ `SkiAdict_Intro_Announce.m4a` ‡∏ß‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏•‡πÇ‡∏Å‡πâ ‡∏£‡∏π‡∏õ‡∏à‡∏∞‡πÅ‡∏Ñ‡πà‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô ‡πÅ‡∏ï‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ)

```html
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ski Addict Auto-Announcement (Fixed Loop)</title>
    <style>
        :root {
            --main-white: #ffffff;
            --main-red: #f45157;
            --light-gray: #f8f9fa;
            --border-gray: #dee2e6;
            --text-dark: #343a40;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--main-white);
            color: var(--text-dark);
            padding: 20px;
            margin: 0 auto;
        }

        .container {
            background-color: var(--main-white);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.05);
            max-width: 1450px;
            margin: 0 auto;
            border: 1px solid var(--border-gray);
        }

        .header-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-img {
            max-width: 250px;
            height: auto;
            margin-bottom: 15px;
        }

        h2 { 
            color: var(--main-red);
            margin: 0;
            font-weight: bold;
        }

        .status-bar {
            text-align: center;
            padding: 15px;
            margin-bottom: 25px;
            font-weight: bold;
            color: var(--text-dark);
            background: var(--light-gray);
            border-radius: 8px;
            border: 2px solid var(--border-gray);
        }

        .status-active { 
            background-color: #e8f5e9;
            color: #2e7d32;
            border-color: #a5d6a7;
        }
        
        .global-section {
            background-color: var(--light-gray);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px solid var(--main-red);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .grid-layout {
            display: grid;
            /* Column structure */
            grid-template-columns: 40px 1fr 95px 50px 70px 60px 160px 90px 70px 50px;
            gap: 10px;
            align-items: center;
        }

        .row-header {
            padding: 15px;
            background: var(--main-red);
            color: white;
            border-radius: 8px 8px 0 0;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
        }
        
        .row-item {
            padding: 15px;
            border-bottom: 1px solid var(--border-gray);
            background: var(--main-white);
        }
        .row-item:nth-child(even) { background-color: var(--light-gray); }
        
        input[type="text"], input[type="time"], select, input[type="number"] {
            padding: 10px;
            border: 1px solid var(--border-gray);
            border-radius: 6px;
            width: 100%;
            box-sizing: border-box;
            text-align: center;
        }
        input[type="text"] { text-align: left; }

        .btn-test {
            background-color: var(--main-red);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
        }

        .btn-add {
            margin-top: 20px;
            background-color: white;
            color: var(--main-red);
            padding: 12px 25px;
            border: 2px solid var(--main-red);
            cursor: pointer;
            border-radius: 6px;
            font-weight: bold;
        }

        .btn-toggle {
            padding: 12px 35px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-start { background-color: #43a047; color: white; }
        .btn-stop { background-color: #d32f2f; color: white; }

        input[type="range"] { width: 100%; accent-color: var(--main-red); }
        .chk-container { display: flex; justify-content: center; align-items: center; flex-direction: column; }
        input[type="checkbox"] { transform: scale(1.4); cursor: pointer; }
        .small-label { font-size: 10px; color: #666; margin-top: 5px; }

        .btn-delete {
            background-color: transparent;
            color: #999;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }
        .btn-delete:hover { color: var(--main-red); }
    </style>
</head>
<body>

<div class="container">
    <div class="header-section">
        <img src="SkiAddict Logo (4).png" alt="Ski Addict Logo" class="logo-img" onerror="this.style.display='none'">
        <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ V.2 (Fixed Loop)</h2>
    </div>
    
    <div id="status-display" class="status-bar">
        ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: üî¥ ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        <div id="clock" style="font-size: 1.4em; margin-top:10px; color: var(--main-red);">--:--:--</div>
        <div id="audio-status" style="font-size: 12px; color: #888; margin-top: 5px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á...</div>
    </div>

    <div class="global-section">
        <div style="flex-grow: 1;">
            <strong style="color: var(--main-red);">üéµ Intro Music:</strong>
            <span id="file-name-display" style="margin-left: 10px; font-weight: bold; color: #333;">SkiAdict_Intro_Announce.m4a</span>
        </div>
        <div style="width: 200px;">
            <label style="font-size: 12px;">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Speed): <span id="speedVal">1.1</span>x</label>
            <input type="range" id="globalSpeed" min="0.5" max="2.0" step="0.1" value="1.1" oninput="updateSpeedLabel(this.value)">
        </div>
        <button id="toggleBtn" class="btn-toggle btn-start" onclick="toggleSystem()">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</button>
    </div>

    <div class="grid-layout row-header">
        <div>#</div>
        <div>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</div>
        <div>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤</div>
        <div>Loop</div>
        <div>‡∏ó‡∏∏‡∏Å(‡∏ô‡∏≤‡∏ó‡∏µ)</div>
        <div style="text-align:center;">‡∏Ç‡∏≤‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</div>
        <div>‡πÄ‡∏™‡∏µ‡∏¢‡∏á / ‡∏†‡∏≤‡∏©‡∏≤</div>
        <div>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏á</div>
        <div>Test</div>
        <div>‡∏•‡∏ö</div>
    </div>
    
    <div id="announcement-list"></div>

    <button class="btn-add" onclick="addRow()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</button>
</div>

<script>
    let introBuffer = null;
    let audioContext = new (window.AudioContext || window.webkitAudioContext)();
    let availableVoices = [];
    let isSystemRunning = false;
    let schedulerInterval = null;
    let rowCount = 0;

    // --- Audio File Loader ---
    function loadIntroFile() {
        const filePath = 'SkiAdict_Intro_Announce.m4a';
        fetch(filePath)
            .then(response => {
                if (!response.ok) throw new Error("File not found");
                return response.arrayBuffer();
            })
            .then(data => audioContext.decodeAudioData(data))
            .then(buffer => {
                introBuffer = buffer;
                document.getElementById('audio-status').innerText = "‚úÖ ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á Intro ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
                document.getElementById('audio-status').style.color = "#43a047";
            })
            .catch(err => {
                console.warn(err);
                document.getElementById('audio-status').innerText = "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå Intro (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î)";
                document.getElementById('audio-status').style.color = "#ff9800";
            });
    }

    // --- Voice Loader ---
    function loadVoices() {
        availableVoices = window.speechSynthesis.getVoices();
        document.querySelectorAll('.voice-select').forEach(select => {
            const currentVal = select.value;
            select.innerHTML = '';
            populateVoiceOptions(select);
            if(currentVal) select.value = currentVal;
        });
    }
    window.speechSynthesis.onvoiceschanged = loadVoices;

    function populateVoiceOptions(selectElement) {
        // Prioritize Japanese (ja) then Thai (th), others follow
        availableVoices.sort((a, b) => {
            if(a.lang.includes('ja')) return -1;
            if(b.lang.includes('ja')) return 1;
            if(a.lang.includes('th')) return -1;
            if(b.lang.includes('th')) return 1;
            return 0;
        }).forEach((voice, index) => {
            const option = document.createElement('option');
            option.value = index;
            option.textContent = `${voice.name.substring(0, 20)} (${voice.lang})`;
            selectElement.appendChild(option);
        });
    }

    function updateSpeedLabel(val) {
        document.getElementById('speedVal').innerText = val;
        saveSettings();
    }

    // --- Spoken Time Logic ---
    function getSpokenTimeText(timeStr, langCode) {
        if(!timeStr) return "";
        let [hours, minutes] = timeStr.split(':').map(Number);
        
        // Use current time for more natural speaking
        const now = new Date();
        hours = now.getHours();
        minutes = now.getMinutes();

        if (langCode.includes('ja')) return `„Åü„Å†„ÅÑ„Åæ„ÄÅ${hours}ÊôÇ${minutes > 0 ? minutes+'ÂàÜ' : ''}„Åß„Åô„ÄÇ`;
        if (langCode.includes('th')) return `‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÄ‡∏ß‡∏•‡∏≤ ${hours} ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ ${minutes > 0 ? minutes+'‡∏ô‡∏≤‡∏ó‡∏µ' : ''}`;
        return `The time is ${hours} ${minutes > 0 ? minutes : "o'clock"}`;
    }

    // --- Audio Player Logic ---
    function playAudio(rowId) {
        if (audioContext.state === 'suspended') audioContext.resume();
        
        const text = document.getElementById(`text-${rowId}`).value;
        const volume = document.getElementById(`vol-${rowId}`).value;
        const voiceIdx = document.getElementById(`voice-${rowId}`).value;
        const doAnnounceTime = document.getElementById(`announce-${rowId}`).checked;
        const speed = document.getElementById('globalSpeed').value;

        window.speechSynthesis.cancel(); // Stop previous

        const speak = () => {
            const utterQueue = [];

            if (doAnnounceTime) {
                const now = new Date();
                const curHM = now.getHours() + ":" + now.getMinutes();
                const uTime = new SpeechSynthesisUtterance(getSpokenTimeText(curHM, availableVoices[voiceIdx]?.lang || 'ja'));
                uTime.volume = volume; 
                uTime.rate = speed;
                if(availableVoices[voiceIdx]) uTime.voice = availableVoices[voiceIdx];
                utterQueue.push(uTime);
            }

            const uText = new SpeechSynthesisUtterance(text);
            uText.volume = volume; 
            uText.rate = speed;
            if(availableVoices[voiceIdx]) uText.voice = availableVoices[voiceIdx];
            utterQueue.push(uText);

            // Play queue
            if(utterQueue.length > 0) {
                window.speechSynthesis.speak(utterQueue[0]);
                if(utterQueue.length > 1) {
                    utterQueue[0].onend = () => window.speechSynthesis.speak(utterQueue[1]);
                }
            }
        };

        if (introBuffer) {
            const source = audioContext.createBufferSource();
            source.buffer = introBuffer;
            source.connect(audioContext.destination);
            source.start(0);
            source.onended = speak;
        } else { speak(); }
    }

    // --- Save/Load System ---
    function saveSettings() {
        const data = [];
        document.querySelectorAll('.row-item').forEach(row => {
            const id = row.getAttribute('data-id');
            data.push({
                text: document.getElementById(`text-${id}`).value,
                time: document.getElementById(`time-${id}`).value,
                loop: document.getElementById(`loop-${id}`).checked,
                interval: document.getElementById(`interval-${id}`).value,
                announce: document.getElementById(`announce-${id}`).checked,
                voice: document.getElementById(`voice-${id}`).value,
                vol: document.getElementById(`vol-${id}`).value
            });
        });
        localStorage.setItem('skiAddictConfigV3', JSON.stringify({
            speed: document.getElementById('globalSpeed').value,
            rows: data
        }));
    }

    function loadSettings() {
        const saved = localStorage.getItem('skiAddictConfigV3');
        if (saved) {
            const config = JSON.parse(saved);
            if(config.speed) {
                document.getElementById('globalSpeed').value = config.speed;
                document.getElementById('speedVal').innerText = config.speed;
            }
            if(config.rows && config.rows.length > 0) {
                config.rows.forEach(item => {
                    const id = addRow();
                    document.getElementById(`text-${id}`).value = item.text;
                    document.getElementById(`time-${id}`).value = item.time;
                    document.getElementById(`loop-${id}`).checked = item.loop;
                    document.getElementById(`interval-${id}`).value = item.interval || 60;
                    document.getElementById(`announce-${id}`).checked = item.announce;
                    document.getElementById(`vol-${id}`).value = item.vol;
                    // Voice selection needs delay to ensure voices loaded
                    setTimeout(() => { document.getElementById(`voice-${id}`).value = item.voice; }, 500);
                });
            } else { addRow(); }
        } else { addRow(); }
    }

    function addRow() {
        rowCount++;
        const id = rowCount;
        const div = document.createElement('div');
        div.className = 'grid-layout row-item';
        div.setAttribute('data-id', id);
        div.innerHTML = `
            <div style="font-weight:bold; color:var(--main-red);">${id}</div>
            <input type="text" id="text-${id}" value="Ski Addict ‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏ó‡πà‡∏≤‡∏ô" oninput="saveSettings()">
            <input type="time" id="time-${id}" oninput="saveSettings()">
            <div class="chk-container"><input type="checkbox" id="loop-${id}" onchange="saveSettings()"></div>
            <div><input type="number" id="interval-${id}" value="60" min="1" oninput="saveSettings()" title="Minutes"></div>
            <div class="chk-container"><input type="checkbox" id="announce-${id}" onchange="saveSettings()"><div class="small-label">On</div></div>
            <select id="voice-${id}" class="voice-select" onchange="saveSettings()"></select>
            <input type="range" id="vol-${id}" min="0.1" max="1" step="0.1" value="0.8" oninput="saveSettings()">
            <button class="btn-test" onclick="playAudio(${id})">Test</button>
            <button class="btn-delete" onclick="this.parentElement.remove(); saveSettings();">√ó</button>
        `;
        document.getElementById('announcement-list').appendChild(div);
        populateVoiceOptions(div.querySelector('.voice-select'));
        return id;
    }

    // --- Scheduler System ---
    function toggleSystem() {
        if (audioContext.state === 'suspended') audioContext.resume();
        isSystemRunning = !isSystemRunning;
        const btn = document.getElementById('toggleBtn');
        const status = document.getElementById('status-display');
        
        if (isSystemRunning) {
            btn.innerText = "‚èπ ‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏∞‡∏ö‡∏ö"; btn.className = "btn-toggle btn-stop";
            status.classList.add("status-active");
            status.firstChild.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: üü¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô";
            schedulerInterval = setInterval(checkSchedule, 1000);
        } else {
            btn.innerText = "‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥"; btn.className = "btn-toggle btn-start";
            status.classList.remove("status-active");
            status.firstChild.textContent = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: üî¥ ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô";
            clearInterval(schedulerInterval);
        }
    }

    function checkSchedule() {
        const now = new Date();
        const currentTotalMinutes = now.getHours() * 60 + now.getMinutes();
        const curSeconds = now.getSeconds();
        
        document.getElementById('clock').innerText = now.toLocaleTimeString('en-GB');
        
        // Trigger only at 00 seconds
        if (curSeconds === 0) {
            document.querySelectorAll('.row-item').forEach(row => {
                const id = row.getAttribute('data-id');
                const timeStr = document.getElementById(`time-${id}`).value;
                if (!timeStr) return;

                const [startH, startM] = timeStr.split(':').map(Number);
                const startTotalMinutes = startH * 60 + startM;
                const isLoop = document.getElementById(`loop-${id}`).checked;
                const interval = parseInt(document.getElementById(`interval-${id}`).value) || 60;

                if (isLoop) {
                    let diff = currentTotalMinutes - startTotalMinutes;
                    if (diff < 0) diff += 1440; // Handle next day crossing
                    
                    // Check if aligned with interval
                    if (diff >= 0 && diff % interval === 0) {
                        playAudio(id);
                    }
                } else {
                    if (currentTotalMinutes === startTotalMinutes) {
                        playAudio(id);
                    }
                }
            });
        }
    }

    window.onload = () => {
        loadIntroFile();
        loadVoices();
        setTimeout(loadSettings, 1000); // Delay load setting slightly
    };
</script>
</body>
</html>

```
